name: Deploy to Testflight

on:   
  workflow_dispatch:
    inputs:
      ref:
        description: "Branch, tag, or commit to build from"
        default: "main"
        required: false
      version:
        description: 'Set the version for the build'
        required: false
      releaseNotes:
        description: 'Release notes for the deployment'
        required: false

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          ref: ${{ github.event.inputs.ref }}

      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: 3.1

      - name: Install dependencies
        run: |
          gem install bundler
          bundle config set --local path 'vendor/bundle'
          bundle config set --local bin 'vendor/bundle/bin'
          bundle install

      - name: Run Fastlane lane
        run: bundle exec fastlane beta
        env:
          VERSION: ${{ github.event.inputs.version }}
          RELEASE_NOTES: ${{ github.event.inputs.releaseNotes }}